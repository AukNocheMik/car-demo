var PlatformCheck=pc.createScript("platformCheck");function isPC(){for(var n=navigator.userAgent,i=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],o=!0,e=0;e<i.length;e++)if(n.indexOf(i[e])>0){o=!1;break}return o}function mobilePlatform(){for(var n=navigator.userAgent,i=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],o="unknown",e=0;e<i.length;e++)if(n.indexOf(i[e])>0){o=i[e];break}return o}PlatformCheck.prototype.initialize=function(){},PlatformCheck.prototype.update=function(n){};var ButtonHelper=pc.createScript("buttonHelper");ButtonHelper.attributes.add("press_event",{type:"string",title:"Pressing button event name",default:"material:change"}),ButtonHelper.attributes.add("mat_num_param",{type:"string"}),ButtonHelper.attributes.add("num_param",{type:"string"}),ButtonHelper.attributes.add("pulseTimeSecs",{type:"number",default:.5,title:"Pulse Time Secs"}),ButtonHelper.prototype.initialize=function(){this.secsSinceStart=this.pulseTimeSecs+1,this.app.mouse?(this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mousedown",this.onPress,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("mouseleave",this.onLeave,this)):(this.entity.element.on("touchstart",this.onTouch,this),this.entity.element.on("touchend",this.onRelease,this)),isPC()||(this.entity.element.width*=2,this.entity.element.height*=2),this.orignalScale=this.entity.getLocalScale(),this.isPressed=!1},ButtonHelper.prototype.update=function(t){if(this.secsSinceStart+=t,this.secsSinceStart<=this.pulseTimeSecs){var e=this.secsSinceStart/this.pulseTimeSecs,s=.3*(2*Math.abs(e-.5))+.7,i=this.entity.getLocalScale();i.set(s,s,s),this.entity.setLocalScale(i)}},ButtonHelper.prototype.onEnter=function(t){},ButtonHelper.prototype.onPress=function(t){this.isPressed=!0},ButtonHelper.prototype.onRelease=function(t){this.isPressed&&(""!==this.mat_num_param?this.app.fire(this.press_event,this.mat_num_param,this.num_param):this.app.fire(this.press_event,this.num_param),this.secsSinceStart=0,this.isPressed=!1)},ButtonHelper.prototype.onTouch=function(t){""!==this.mat_num_param?this.app.fire(this.press_event,this.mat_num_param,this.num_param):this.app.fire(this.press_event,this.num_param),this.secsSinceStart=0,this.isPressed=!1},ButtonHelper.prototype.onLeave=function(t){},ButtonHelper.prototype.swap=function(t){};var Camera360=pc.createScript("camera360");Camera360.attributes.add("mouseLookSensitivity",{type:"number",default:0,title:"Mouse Look Sensitivity"}),Camera360.attributes.add("touchLookSensitivity",{type:"number",default:0,title:"Touch Look Sensitivity"}),Camera360.attributes.add("snappinessFactor",{type:"number",default:.1,title:"Snappiness Factor",description:"Lower is faster"}),Camera360.prototype.initialize=function(){this._tempQuat1=new pc.Quat,this._tempQuat2=new pc.Quat,this._tempVec3_1=new pc.Vec3,this.default_forward=this.entity.forward.clone();var t=this.entity.getLocalRotation();this.resetCamRotation=this.entity.getLocalRotation().clone(),this.ey=-this.getYaw(t)*pc.math.RAD_TO_DEG,this.ex=-this.getPitch(t,this.ey)*pc.math.RAD_TO_DEG,this.targetEx=this.ex,this.targetEy=this.ey,this.moved=!1,this.app.mouse.disableContextMenu(),this.lastTouchPosition=new pc.Vec2,this.isTwoTouch=!1,this.addEventCallbacks(),this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.app.on("camera-360:resetRotation",this.resetRotation,this)},Camera360.prototype.addEventCallbacks=function(){this.app.mouse&&(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this))},Camera360.prototype.resetRotation=function(){this.ey=-this.getYaw(this.resetCamRotation)*pc.math.RAD_TO_DEG,this.ex=-this.getPitch(this.resetCamRotation,this.ey)*pc.math.RAD_TO_DEG,this.targetEx=this.ex,this.targetEy=this.ey},Camera360.prototype.update=function(t){var e=1;this.snappinessFactor>0&&(e=t/this.snappinessFactor),this.ex=pc.math.lerp(this.ex,this.targetEx,e),this.ey=pc.math.lerp(this.ey,this.targetEy,e),this.entity.setLocalEulerAngles(-this.ex,-this.ey,0)},Camera360.prototype.moveCamera=function(t,e,i){this.entity.enabled&&(this.moved?(this.targetEx-=e*i,this.targetEx=pc.math.clamp(this.targetEx,-43,43),this.targetEy-=t*i):this.moved=!0)},Camera360.prototype.onMouseDown=function(t){this.entity.enabled},Camera360.prototype.onMouseUp=function(t){this.entity.enabled},Camera360.prototype.onMouseWheel=function(t){this.entity.enabled&&this.entity.script.changeCameraFov.MousecamFovScale(t.wheel)},Camera360.prototype.onMouseMove=function(t){this.entity.enabled&&this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity)},Camera360.prototype.onTouchStart=function(t){if(this.entity.enabled)if(1===t.touches.length){this.isTwoTouch=!1;var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y),this.needSetHotSpot=!0}else 2===t.touches.length&&(this.isTwoTouch=!0,this.lastPinchDistance=this.getPinchDistance(t.touches[0],t.touches[1]),this.calcMidPoint(t.touches[0],t.touches[1],this.lastPinchMidPoint))},Camera360.prototype.getPinchDistance=function(t,e){var i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)},Camera360.prototype.calcMidPoint=function(t,e,i){i.set(e.x-t.x,e.y-t.y),i.scale(.5),i.x+=t.x,i.y+=t.y},Camera360.pinchMidPoint=new pc.Vec2,Camera360.prototype.onTouchMove=function(t){if(this.entity.enabled)if(1!==t.touches.length||this.isTwoTouch){if(2===t.touches.length){var e=this.getPinchDistance(t.touches[0],t.touches[1]),i=e-this.lastPinchDistance;this.lastPinchDistance=e,this.entity.script.changeCameraFov.TouchcamFovScale(i)}}else{var s=t.touches[0];this.moveCamera(s.x-this.lastTouchPosition.x,s.y-this.lastTouchPosition.y,this.touchLookSensitivity),this.lastTouchPosition.set(s.x,s.y)}},Camera360.prototype.onTouchEnd=function(t){},Camera360.prototype.getYaw=function(){return Math.atan2(-this.default_forward.x,-this.default_forward.z)},Camera360.prototype.getPitch=function(t,e){var i=this._tempQuat1,s=this._tempQuat2;s.setFromEulerAngles(0,-e,0),i.mul2(s,t);var o=this._tempVec3_1;return i.transformVector(pc.Vec3.FORWARD,o),Math.atan2(o.y,-o.z)},Camera360.prototype.reflow=function(){this.enabled&&this.app.graphicsDevice.width/this.app.graphicsDevice.height>1&&this.entity.script.changeCameraFov.setMinFov()};var OrbitCameraControl=pc.createScript("orbitCameraControl");OrbitCameraControl.attributes.add("sensivity",{type:"number",default:.5}),OrbitCameraControl.attributes.add("easing",{type:"number",default:.2}),OrbitCameraControl.attributes.add("pitchAxisMax",{type:"number",default:75}),OrbitCameraControl.attributes.add("pitchAxisMin",{type:"number",default:-80}),OrbitCameraControl.attributes.add("autoRotationColdown",{type:"number",default:5e3}),OrbitCameraControl.attributes.add("fixedPostionMoveCurve",{type:"curve"}),OrbitCameraControl.attributes.add("fixedPostionRotationCanInterrupt",{type:"boolean"}),OrbitCameraControl.attributes.add("setPauseEvent",{type:"string",default:"pauseCam:ext"}),OrbitCameraControl.attributes.add("initPitch",{type:"number",default:0}),OrbitCameraControl.attributes.add("initYaw",{type:"number",default:0}),OrbitCameraControl.prototype.initialize=function(){this.enabled=this.entity.enabled,this.weight=1,this.oldQuat=new pc.Quat,this.pitchS=-20,this.yawS=10,this.app.mouse&&(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this)),this.app.on(this.setPauseEvent,this.onSetPause,this),this.rotating=!1,this.pitch=this.initPitch,this.yaw=this.initYaw,this.pitchTarget=this.pitch,this.yawTarget=this.yaw,this.m={x:0,y:0},this.ml={x:0,y:0},this.entity.setEulerAngles(this.pitch,this.yaw,0),this.rotateEnd=Date.now(),this.touchInd=-1,this.app.on("rotate_in_period",this.onRotateInPeriod,this),this.mode=1,this.fixedPositionRotationTimeCount=0,this.lastPinchDistance=0,this.bPauseControl=!1},OrbitCameraControl.prototype.onSetPause=function(t){this.bPauseControl=t},OrbitCameraControl.prototype.onMouseDown=function(t){this.bPauseControl||(2!=this.mode||this.fixedPostionRotationCanInterrupt)&&(this.rotating=!0,this.m.x=t.x,this.m.y=t.y,this.ml.x=t.x,this.ml.y=t.y,this.mode=1,this.fixedPositionRotationTimeCount=0)},OrbitCameraControl.prototype.onRotateInPeriod=function(t,i,o){this.fixedPositionRotationDuration=o,this.manualPitch=t,this.manualYaw=i,this.currentPitch=this.pitch,this.currentYaw=this.yaw,this.mode=2,this.fixedPositionRotationTimeCount=0},OrbitCameraControl.prototype.onMouseMove=function(t){this.bPauseControl||(this.m.x=t.x,this.m.y=t.y)},OrbitCameraControl.prototype.onMouseUp=function(){this.bPauseControl||(this.rotating=!1,this.rotateEnd=Date.now())},OrbitCameraControl.prototype.onTouchStart=function(t){if(!this.bPauseControl&&((2!=this.mode||this.fixedPostionRotationCanInterrupt)&&(this.rotating=!0,-1===this.touchInd&&t.touches.length&&1===t.touches.length))){var i=t.touches[0];this.touchInd=i.identifier,this.m.x=i.x,this.m.y=i.y,this.ml.x=this.m.x,this.ml.y=this.m.y,this.mode=1,this.fixedPositionRotationTimeCount=0}},OrbitCameraControl.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,s=t.y-i.y;return Math.sqrt(o*o+s*s)},OrbitCameraControl.prototype.onTouchMove=function(t){if(!this.bPauseControl){var i=t.touches;if(1===i.length){var o=i[0];this.m.x=o.x,this.m.y=o.y}else i.length}},OrbitCameraControl.prototype.onTouchEnd=function(t){this.bPauseControl||(this.rotating=!1,this.rotateEnd=Date.now(),this.touchInd=-1)},OrbitCameraControl.prototype.update=function(t){if(this.enabled)switch(this.mode){case 1:if(this.rotating){var i=this.ml.x-this.m.x,o=this.ml.y-this.m.y;this.pitchTarget=Math.max(-this.pitchAxisMax,Math.min(this.pitchAxisMin,this.pitchTarget+o*this.sensivity)),this.yawTarget+=i*this.sensivity,this.ml.x=this.m.x,this.ml.y=this.m.y}else Date.now()-this.rotateEnd>this.autoRotationColdown&&(this.yawTarget+=10*t*Math.min(1,(Date.now()-this.rotateEnd-1e3)/2e3));Math.abs(this.pitch-this.pitchTarget)+Math.abs(this.yaw-this.yawTarget)>.1&&(this.pitch+=(this.pitchTarget-this.pitch)*this.easing,this.yaw+=(this.yawTarget-this.yaw)*this.easing,this.oldQuat.copy(this.entity.getRotation()),this.entity.setEulerAngles(this.pitch,this.yaw,0),this.oldQuat.slerp(this.oldQuat,this.entity.getRotation(),this.weight),this.entity.setRotation(this.oldQuat));break;case 2:this.fixedPositionRotationTimeCount+=t;var s=this.currentPitch+this.manualPitch*this.fixedPostionMoveCurve.value(this.fixedPositionRotationTimeCount/this.fixedPositionRotationDuration),e=this.currentYaw+this.manualYaw*this.fixedPostionMoveCurve.value(this.fixedPositionRotationTimeCount/this.fixedPositionRotationDuration);this.oldQuat.copy(this.entity.getRotation()),this.entity.setEulerAngles(s,e,0),this.oldQuat.slerp(this.oldQuat,this.entity.getRotation(),this.weight),this.entity.setRotation(this.oldQuat),this.pitch=s,this.yaw=e,this.pitchTarget=this.pitch,this.yawTarget=this.yaw,this.fixedPositionRotationTimeCount>=this.fixedPositionRotationDuration&&(this.rotateEnd=Date.now(),this.mode=1,this.fixedPositionRotationTimeCount=0)}};var ChangeCameraFov=pc.createScript("changeCameraFov");ChangeCameraFov.attributes.add("minFov",{type:"number",default:45,title:"最小视角"}),ChangeCameraFov.attributes.add("maxFov",{type:"number",default:90,title:"最大视角"}),ChangeCameraFov.prototype.initialize=function(){if(this.old_minFov=this.minFov,this.old_maxFov=this.maxFov,this.cam=this.entity.camera,this.resetCamFOV=this.cam.fov,this.cam.horizontalFov=!0,this.mult=(this.maxFov-this.minFov)/8,this.distance=pc.math.lerp(this.minFov,this.maxFov,.5),this.targetDistance=this.distance,!isPC()){this.app.graphicsDevice.width/this.app.graphicsDevice.height<1&&this.setVerticalFov();var t=this;window.addEventListener("resize",function(){t.app.graphicsDevice.width/t.app.graphicsDevice.height<1?t.setVerticalFov():t.setHorizontalFov()})}this.targetDistance=pc.math.clamp(this.targetDistance,this.maxFov,this.maxFov),this.app.on("ChangeCameraFov:resetFOV",this.resetFOV,this)},ChangeCameraFov.prototype.resetFOV=function(){this.cam.fov=this.resetCamFOV},ChangeCameraFov.prototype.update=function(t){this.distance=pc.math.lerp(this.distance,this.targetDistance,t/.2),this.cam.fov=this.distance},ChangeCameraFov.prototype.MousecamFovScale=function(t){var i=t*-this.mult;this.targetDistance+=i,this.targetDistance=pc.math.clamp(this.targetDistance,this.minFov,this.maxFov)},ChangeCameraFov.prototype.TouchcamFovScale=function(t){var i=t/25*-this.mult;this.targetDistance+=i,this.targetDistance=pc.math.clamp(this.targetDistance,this.minFov,this.maxFov)},ChangeCameraFov.prototype.setVerticalFov=function(){this.minFov=this.old_minFov/1.5,this.maxFov=this.old_maxFov/1.5,this.targetDistance=(this.minFov+this.maxFov)/2},ChangeCameraFov.prototype.setHorizontalFov=function(){this.minFov=this.old_minFov,this.maxFov=this.old_maxFov,this.targetDistance=(this.minFov+this.maxFov)/2};var FixedCameraPosition=pc.createScript("fixedCameraPosition");FixedCameraPosition.attributes.add("camera_entity",{type:"entity",title:"camera entity"}),FixedCameraPosition.attributes.add("trigger_event",{type:"string",title:"trigger event"}),FixedCameraPosition.prototype.initialize=function(){this.app.on(this.trigger_event,this.calculateEulerAngles,this)},FixedCameraPosition.prototype.calculateEulerAngles=function(){var t=this.camera_entity.getPosition(),e=this.entity.getPosition();t.normalize(),e.normalize();var i=new pc.Vec3(t.x,0,t.z),a=180*Math.acos(t.dot(i)/(t.length()*i.length()))/Math.PI,n=new pc.Vec3(e.x,0,e.z),r=a-180*Math.acos(e.dot(n)/(e.length()*n.length()))/Math.PI,o=new pc.Vec3(t.x,0,t.z),c=new pc.Vec3(e.x,0,e.z),s=180*Math.acos(o.dot(c)/(o.length()*c.length()))/Math.PI;s*=(new pc.Vec3).cross(o,c).y>0?1:-1,this.app.fire("rotate_in_period",r,s,1),"cam_4"!==this.trigger_event&&"cam_3"!==this.trigger_event&&"cam_2"!==this.trigger_event&&"cam_1"!==this.trigger_event&&this.app.fire("zoom_camera_whenOpenHotspot")},FixedCameraPosition.prototype.update=function(t){};var InteriorController=pc.createScript("interiorController");InteriorController.attributes.add("pano_mat",{type:"asset",assetType:"material"}),InteriorController.attributes.add("config_json",{type:"asset",assetType:"json"}),InteriorController.attributes.add("seat_hotspots",{type:"entity",array:!0}),InteriorController.attributes.add("hotspot_non_ts_spec",{type:"entity",array:!0,title:"非TS高配热点"}),InteriorController.attributes.add("hotspot_non_ts_all",{type:"entity",array:!0,title:"非TS普通热点"}),InteriorController.attributes.add("hotspot_ts_all",{type:"entity",array:!0,title:"TS热点"}),InteriorController.attributes.add("hotspots_zhixiang_only",{type:"entity",array:!0,title:"质享车型热点"}),InteriorController.attributes.add("seats_7",{type:"entity",array:!0,title:"7座机位热点"}),InteriorController.attributes.add("seats_non_7",{type:"entity",array:!0,title:"非7座机位热点"}),InteriorController.attributes.add("int_cam",{type:"entity",title:"内饰相机"}),InteriorController.prototype.initialize=function(){this.modelList=["5_liangqu_shushi","5_liangqu_zhixiang","5_liangqu_haohua","5_siqu_haohua","5_siqu_qijian","7_liangqu_zhixiang","TS_haohua"],this.modelList_spec=["5_liangqu_haohua","5_siqu_qijian","TS_haohua"],this.texture_config=this.config_json.resource;for(var t=0;t<this.modelList.length;t++)for(var o=5===t?3:2,i=0;i<o;i++)for(var e=0;e<2;e++){var n=this.texture_config[this.modelList[t]]["Color"+e]["Position"+i],s=this.app.assets.find(n+".jpg","texture");s?this.texture_config[this.modelList[t]]["Color"+e]["Position"+i]=s:console.error("cant find texture: "+n)}this.default_cam_rotation=this.int_cam.getRotation().clone(),this.modelName="",this.lastLoadedModel="",this.positionIndex=0,this.colorIndex=0,this.fadeDuration=500,this.app.on("interior:change_position",this.changePosition,this),this.app.on("interior:change_color",this.changeColor,this),this.bDirty=!0,this.bInstantAction=!1},InteriorController.prototype.update=function(t){},InteriorController.prototype.setInstantAction=function(t){this.bInstantAction=t},InteriorController.prototype.isDirty=function(){return this.bDirty},InteriorController.prototype.loadAllPano=function(){for(var t=0;t<this.modelList.length;t++)for(var o=5===t?3:2,i=0;i<o;i++)for(var e=0;e<2;e++)this.app.fire("loadTexture",this.texture_config[this.modelList[t]]["Color"+e]["Position"+i])},InteriorController.prototype.changePosition=function(t,o){(this.positionIndex!==t||o)&&(this.positionIndex=t,this.change(!0),window.parent&&window.parent.func7&&window.parent.func7(t))},InteriorController.prototype.changeColor=function(t,o){(this.colorIndex!==t||o)&&(this.colorIndex=t,this.change(!1))},InteriorController.prototype.change=function(t,o){var i=this.texture_config[this.modelName]["Color"+this.colorIndex]["Position"+this.positionIndex],e=this;this.loadTextureStart(i,function(i){t&&(e.changeHotSpotVisibility(e.positionIndex),e.app.fire("camera-360:resetRotation")),e.loadTextureComplete(i),e.bDirty=!1,o&&o()})},InteriorController.prototype.loadTextureStart=function(t,o){t.resource?o(t):(window.parent&&window.parent.intload&&window.parent.intload(0),this.entity.script.assetLoader.startLoad(t,function(t){o(t),window.parent&&window.parent.intload&&window.parent.intload(1)}))},InteriorController.prototype.changeModelInstantly=function(t){if(-1!==this.modelList.indexOf(t)){if(this.modelName!==t){this.lastLoadedModel=this.modelName,this.modelName=t;var o=!1;this.lastLoadedModel===this.modelList[5]||this.modelName===this.modelList[5]?(o=!0,this.lastLoadedModel===this.modelList[5]&&2===this.positionIndex&&(this.positionIndex=0)):o=!1,this.modelName==this.modelList[6]?this.colorIndex=1:this.colorIndex=0;var e=this;if(console.log("changeModelInstantly "+this.modelName+" c"+this.colorIndex+"p"+this.positionIndex),this.change(o,function(){setTimeout(function(){e.unloadTextures()},1e3)}),"TS_haohua"!==this.modelName){for(i=0;i<this.hotspot_non_ts_all.length;i++)this.hotspot_non_ts_all[i].enabled=!0;for(i=0;i<this.hotspot_non_ts_spec.length;i++)this.hotspot_non_ts_spec[i].enabled=-1!=this.modelList_spec.indexOf(this.modelName);for(i=0;i<this.hotspots_zhixiang_only.length;i++)this.hotspots_zhixiang_only[i].enabled=this.modelName===this.modelList[5]||this.modelName===this.modelList[1];for(i=0;i<this.hotspot_ts_all.length;i++)this.hotspot_ts_all[i].enabled=!1}else{for(i=0;i<this.hotspot_non_ts_all.length;i++)this.hotspot_non_ts_all[i].enabled=!1;for(i=0;i<this.hotspot_non_ts_spec.length;i++)this.hotspot_non_ts_spec[i].enabled=!1;for(i=0;i<this.hotspots_zhixiang_only.length;i++)this.hotspots_zhixiang_only[i].enabled=!1;for(i=0;i<this.hotspot_ts_all.length;i++)this.hotspot_ts_all[i].enabled=!0}for(i=0;i<this.seats_7.length;i++)this.seats_7[i].enabled="7_liangqu_zhixiang"===this.modelName;for(i=0;i<this.seats_non_7.length;i++)this.seats_non_7[i].enabled="7_liangqu_zhixiang"!==this.modelName}}else console.error("can not find model:"+t)},InteriorController.prototype.setDirtyModelName=function(t){this.modelName!=t&&(this.bDirty=!0,this.dirtyModelName=t)},InteriorController.prototype.changeModelDelayed=function(){this.bDirty&&this.changeModelInstantly(this.dirtyModelName)},InteriorController.prototype.unloadTextures=function(){if(""!==this.lastLoadedModel)for(var t=this.lastLoadedModel===this.modelList[5]?3:2,o=0;o<2;o++)for(var i=0;i<t;i++){var e=this.texture_config[this.lastLoadedModel]["Color"+o]["Position"+i];e.loaded&&e.unload()}},InteriorController.prototype.loadTextureComplete=function(t){t.resource&&(this.pano_mat.resources[0].emissiveMap=t.resource,this.pano_mat.resources[0].update())},InteriorController.prototype.changeHotSpotVisibility=function(t){for(i=0;i<this.seat_hotspots.length;i++)i===t?this.seat_hotspots[i].enabled=!0:this.seat_hotspots[i].enabled=!1};var DoorController=pc.createScript("doorController");DoorController.attributes.add("trigger_event",{type:"string",title:"触发事件"}),DoorController.attributes.add("open_event",{type:"string",title:"开门事件"}),DoorController.attributes.add("close_event",{type:"string",title:"关门事件"}),DoorController.attributes.add("rotate_euler_angle",{type:"vec3",title:"XYZ旋转角度"}),DoorController.attributes.add("rotate_dur",{type:"number",title:"播放时长（秒）"}),DoorController.attributes.add("rotate_curve",{type:"curve",title:"曲线图"}),DoorController.attributes.add("blocker",{type:"entity",title:"门框"}),DoorController.prototype.initialize=function(){this.bPlayReverse=!1,this.app.on(this.trigger_event,this.onRotate,this),this.app.on(this.open_event,this.onOpen,this),this.app.on(this.close_event,this.onClose,this),this.lastRotation=new pc.Vec3,this.currentState=0},DoorController.prototype.onOpen=function(){this.bPlayReverse||this.onRotate()},DoorController.prototype.onClose=function(){this.bPlayReverse&&this.onRotate()},DoorController.prototype.onRotate=function(){this.bRotating||(this.startRotation=this.entity.getLocalEulerAngles(),this.targetRotation=new pc.Vec3,this.targetRotation=this.bPlayReverse?this.targetRotation.sub2(this.startRotation,this.rotate_euler_angle):this.targetRotation.add2(this.startRotation,this.rotate_euler_angle),this.timeCount=0,this.bRotating=!0,this.lastRotation=new pc.Vec3,!this.bPlayReverse&&this.blocker&&(this.blocker.enabled=!1))},DoorController.prototype.rotate=function(t){var e=new pc.Vec3;e.lerp(this.startRotation,this.targetRotation,t),this.entity.setLocalEulerAngles(e)},DoorController.prototype.update=function(t){if(this.bRotating){if(this.timeCount+=t,this.timeCount>=this.rotate_dur)return this.rotate(1),this.bRotating=!1,this.bPlayReverse=!this.bPlayReverse,void(!this.bPlayReverse&&this.blocker&&(this.blocker.enabled=!0));var e=this.rotate_curve.value(this.timeCount);this.rotate(e)}};var ModelController=pc.createScript("modelController");ModelController.attributes.add("config_json",{type:"asset",assetType:"json",title:"模型配置"}),ModelController.attributes.add("hotspot_non_ts_spec",{type:"entity",title:"非TS车型特殊卖点"}),ModelController.attributes.add("hotspot_non_ts_all",{type:"entity",title:"非TS车型普遍卖点"}),ModelController.attributes.add("hotspot_ts_all",{type:"entity",title:"TS车型普遍卖点"}),ModelController.prototype.initialize=function(){this.currModel={},this.nextModel={},this.allModels={},this.loadConfig(),this.currModelName=""},ModelController.prototype.update=function(t){},ModelController.prototype.setCurrentModel=function(t){this.currModelName=t},ModelController.prototype.findEntities=function(t){var o=this;return this.app.root.find(function(e){var l=!1;e.model&&e.model.asset&&(o.app.assets.get(e.model.asset).name===t+".json"&&(l=!0));return l})},ModelController.prototype.loadConfig=function(){this.modelConfig=this.config_json.resource;for(var t=0;t<this.modelConfig.all_models.length;t++){var o=this.modelConfig.all_models[t];this.allModels[o]={},this.allModels[o].entities=[],this.allModels[o].model_file_names=this.modelConfig[o];for(var e=0;e<this.allModels[o].model_file_names.length;e++){var l=this.allModels[o].model_file_names[e],i=this.findEntities(l);this.allModels[o].entities=this.allModels[o].entities.concat(i)}}this.allModels.clearcoat_entites=this.app.root.findByTag("clearcoat"),this.allModels.interior={low:this.app.root.findByTag("int_low"),high:this.app.root.findByTag("int_high"),ts:this.app.root.findByTag("int_ts"),seven_seats:this.app.root.findByTag("int_7")},this.allModels.exterior={low:this.app.root.findByTag("ext_low"),high:this.app.root.findByTag("ext_high"),ts:this.app.root.findByTag("ext_ts")},this.allModels.plate={ts:this.app.root.findByTag("plate_ts"),non_ts:this.app.root.findByTag("plate_none_ts")}},ModelController.prototype.changeModel=function(t){if(this.allModels[t]&&this.allModels[t].entities){var o=[],e=[];o=this.allModels[this.currModelName].entities,e=this.allModels[t].entities,"TS_haohua"===t?(o=(o=o.concat(this.allModels.clearcoat_entites)).concat(this.allModels.plate.non_ts),e=e.concat(this.allModels.plate.ts)):(e=(e=e.concat(this.allModels.clearcoat_entites)).concat(this.allModels.plate.non_ts),o=o.concat(this.allModels.plate.ts)),"5_liangqu_haohua"!==t&&"5_siqu_qijian"!==t||(e=e.concat(this.allModels.interior.high),o=(o=(o=o.concat(this.allModels.interior.seven_seats)).concat(this.allModels.interior.low)).concat(this.allModels.interior.ts)),"5_liangqu_shushi"!==t&&"5_liangqu_zhixiang"!==t&&"5_siqu_haohua"!==t||(e=e.concat(this.allModels.interior.low),o=(o=(o=o.concat(this.allModels.interior.high)).concat(this.allModels.interior.seven_seats)).concat(this.allModels.interior.ts)),"7_liangqu_zhixiang"===t&&(e=(e=e.concat(this.allModels.interior.low)).concat(this.allModels.interior.seven_seats),o=(o=o.concat(this.allModels.interior.high)).concat(this.allModels.interior.ts)),"TS_haohua"===t&&(o=(o=(o=o.concat(this.allModels.interior.low)).concat(this.allModels.interior.seven_seats)).concat(this.allModels.interior.high),e=e.concat(this.allModels.interior.ts),o=(o=o.concat(this.allModels.exterior.low)).concat(this.allModels.exterior.high),e=e.concat(this.allModels.exterior.ts),this.entity.script.headlightController.turnOnDayLight()),"5_liangqu_haohua"!==t&&"5_siqu_haohua"!==t&&"5_siqu_qijian"!==t||(o=(o=o.concat(this.allModels.exterior.low)).concat(this.allModels.exterior.ts),e=e.concat(this.allModels.exterior.high),this.entity.script.headlightController.turnOnDayLight()),"5_liangqu_shushi"!==t&&"5_liangqu_zhixiang"!==t&&"7_liangqu_zhixiang"!==t||(o=(o=o.concat(this.allModels.exterior.high)).concat(this.allModels.exterior.ts),e=e.concat(this.allModels.exterior.low),this.entity.script.headlightController.turnOffDayLight());for(var l=this.hotspot_non_ts_spec.find(function(t){return!0}),i=0;i<l.length;i++){var s=l[i];s.enabled=s.tags.has(t)}this.hotspot_non_ts_all.enabled="TS_haohua"!==t,this.hotspot_ts_all.enabled="TS_haohua"===t;for(i=0;i<o.length;i++)o[i].enabled=!1;for(i=0;i<e.length;i++)e[i].enabled=!0;this.currModelName=t}else console.error("invalid model name: "+t)},ModelController.prototype.compare=function(t,o){for(var e={hide:[],show:[]},l=0;l<t.length;l++){for(var i=t[l],s=!1,a=0;a<o.length;a++){var n=o[a];if(i.model.asset===n.model.asset){s=!0;break}}s||e.hide.push(i)}for(l=0;l<o.length;l++){for(n=o[l],s=!1,a=0;a<t.length;a++){if((i=t[a]).model.asset===n.model.asset){s=!0;break}}s||e.show.push(n)}return e},ModelController.prototype.isHighHeadlight=function(){return"5_liangqu_haohua"===this.currModelName||"5_siqu_haohua"===this.currModelName||"5_siqu_qijian"===this.currModelName||"TS_haohua"===this.currModelName};var Pulse=pc.createScript("pulse");Pulse.attributes.add("pulseTimeSecs",{type:"number",default:2,title:"Pulse Time Secs"}),Pulse.prototype.initialize=function(){this.secsSinceStart=this.pulseTimeSecs+1,this.entity.on("pulse:start",this.onStartEvent,this)},Pulse.prototype.update=function(t){if(this.secsSinceStart+=t,this.secsSinceStart<=this.pulseTimeSecs){var e=this.secsSinceStart/this.pulseTimeSecs,s=.3*(2*Math.abs(e-.5))+.7,i=this.entity.getLocalScale();i.set(s,s,s),this.entity.setLocalScale(i)}},Pulse.prototype.onStartEvent=function(){this.secsSinceStart=0};var SwitchScene=pc.createScript("switchScene");SwitchScene.attributes.add("extIntScene",{title:"Scenes",type:"entity",array:!0}),SwitchScene.prototype.initialize=function(){this.scene_index=0},SwitchScene.prototype.update=function(e){},SwitchScene.prototype.onChangeSceneEventPreHandler=function(e){if(this.scene_index!=e){this.scene_index=e;for(var t=0;t<this.extIntScene.length;t++)t==this.scene_index?this.extIntScene[t].enabled=!0:this.extIntScene[t].enabled=!1}},SwitchScene.prototype.switchSkybox=function(e){};var DistanceZoom=pc.createScript("distanceZoom");DistanceZoom.attributes.add("minDistance_vert",{type:"number",default:5,title:"min distance vert"}),DistanceZoom.attributes.add("maxDistance_vert",{type:"number",default:8,title:"max distance vert"}),DistanceZoom.attributes.add("minDistance_horz",{type:"number",default:10,title:"min distance horz"}),DistanceZoom.attributes.add("maxDistance_horz",{type:"number",default:16,title:"max distance horz"}),DistanceZoom.attributes.add("sensitivity",{type:"number",default:1}),DistanceZoom.attributes.add("inertia",{type:"number",default:0}),DistanceZoom.attributes.add("setPauseEvent",{type:"string",default:"pauseCam:ext"}),DistanceZoom.prototype.initialize=function(){this.app.graphicsDevice.width/this.app.graphicsDevice.height<1?this.setVerticalDistance():this.setHorizontalDistance();var t=this;window.addEventListener("resize",function(){t.app.graphicsDevice.width/t.app.graphicsDevice.height<1?t.setVerticalDistance():t.setHorizontalDistance()}),this.app.on(this.setPauseEvent,this.onSetPause,this);var i=new pc.Vec3;i.sub2(this.entity.getPosition().clone(),this.entity.parent.getPosition().clone()),this.distance=this.clampDistance(i.length()),this.app.mouse&&this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onZoom,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)),this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.targetDistance=(this.minDistance+this.maxDistance)/2,this.bPauseControl=!1,this.app.on("zoom_camera_whenOpenHotspot",this.zoomCamDistance_hotspot,this)},DistanceZoom.prototype.update=function(t){var i=0===this.inertia?1:Math.min(t/this.inertia,1);this.distance=pc.math.lerp(this.distance,this.targetDistance,i);var e=this.entity.getPosition();e.copy(this.entity.forward),e.scale(-this.distance),e.add(this.entity.parent.getPosition()),this.entity.setPosition(e)},DistanceZoom.prototype.zoomCamDistance_hotspot=function(){this.targetDistance=this.minDistance,this.targetDistance=this.clampDistance(this.targetDistance)},DistanceZoom.prototype.onSetPause=function(t){this.bPauseControl=t},DistanceZoom.prototype.onZoom=function(t){this.entity.enabled&&(this.targetDistance-=t.wheel*this.sensitivity*(.1*this.distance),this.targetDistance=this.clampDistance(this.targetDistance))},DistanceZoom.prototype.clampDistance=function(t){return this.maxDistance>0?pc.math.clamp(t,this.minDistance,this.maxDistance):Math.max(t,this.minDistance)},DistanceZoom.prototype.onTouchStartEndCancel=function(t){if(this.entity.enabled){var i=t.touches;2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]))}},DistanceZoom.prototype.onTouchMove=function(t){if(!this.bPauseControl){var i=t.touches;if(2==i.length){var e=this.getPinchDistance(i[0],i[1]),s=e-this.lastPinchDistance;this.lastPinchDistance=e,this.targetDistance-=s*this.sensitivity*.1*(.1*this.distance),this.targetDistance=this.clampDistance(this.targetDistance)}}},DistanceZoom.prototype.getPinchDistance=function(t,i){var e=t.x-i.x,s=t.y-i.y;return Math.sqrt(e*e+s*s)},DistanceZoom.prototype.setVerticalDistance=function(){this.minDistance=2.4*this.minDistance_vert,this.maxDistance=2*this.maxDistance_vert,this.targetDistance=(this.minDistance+this.maxDistance)/2},DistanceZoom.prototype.setHorizontalDistance=function(){this.minDistance=this.minDistance_horz,this.maxDistance=this.maxDistance_horz,this.targetDistance=(this.minDistance+this.maxDistance)/2};var OpenLights=pc.createScript("openLights");OpenLights.attributes.add("CarLights",{type:"entity"}),OpenLights.prototype.initialize=function(){this.isOpenLight=!1,this.CarLights.enabled=!1,this.app.on("light:open_light",this.onOpenLightEventPreHandler,this)},OpenLights.prototype.update=function(t){},OpenLights.prototype.onOpenLightEventPreHandler=function(){this.isOpenLight?(this.CarLights.enabled=!1,this.isOpenLight=!1):(this.CarLights.enabled=!0,this.isOpenLight=!0)};"undefined"!=typeof document&&(function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,o){function g(t,e,n,o){return p[0|t][Math.round(Math.min((e-n)/(o-n)*z,z))]}function r(){C.legend.fps!==L&&(C.legend.fps=L,C.legend[c]=L?"FPS":"ms"),w=L?O.fps:O.duration,C.count[c]=999<w?"999+":w.toFixed(99<w?0:F.decimals)}function m(){for(l=n(),T<l-F.threshold&&(O.fps-=O.fps/Math.max(1,60*F.smoothing/F.interval),O.duration=1e3/O.fps),y=F.history;y--;)j[y]=0===y?O.fps:j[y-1],q[y]=0===y?O.duration:q[y-1];if(r(),F.heat){if(E.length)for(y=E.length;y--;)E[y].el.style[h[E[y].name].heatOn]=L?g(h[E[y].name].heatmap,O.fps,0,F.maxFps):g(h[E[y].name].heatmap,O.duration,F.threshold,0);if(C.graph&&h.column.heatOn)for(y=M.length;y--;)M[y].style[h.column.heatOn]=L?g(h.column.heatmap,j[y],0,F.maxFps):g(h.column.heatmap,q[y],F.threshold,0)}if(C.graph)for(v=0;v<F.history;v++)M[v].style.height=(L?j[v]?Math.round(b/F.maxFps*Math.min(j[v],F.maxFps)):0:q[v]?Math.round(b/F.threshold*Math.min(q[v],F.threshold)):0)+"px"}function k(){20>F.interval?(f=i(k),m()):(f=setTimeout(k,F.interval),x=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),O.toggle()}function U(){F.toggleOn&&S(C.container,F.toggleOn,G,1),t.removeChild(C.container)}function V(){if(C.container&&U(),h=D.theme[F.theme],!(p=h.compiledHeatmaps||[]).length&&h.heatmaps.length){for(v=0;v<h.heatmaps.length;v++)for(p[v]=[],y=0;y<=z;y++){var e,n=p[v],o=y;e=.33/z*y;var a=h.heatmaps[v].saturation,i=h.heatmaps[v].lightness,l=void 0,c=void 0,u=void 0,d=u=void 0,g=l=c=void 0;g=void 0;0===(u=.5>=i?i*(1+a):i+a-i*a)?e="#000":(c=(u-(d=2*i-u))/u,g=(e*=6)-(l=Math.floor(e)),g*=u*c,0===l||6===l?(l=u,c=d+g,u=d):1===l?(l=u-g,c=u,u=d):2===l?(l=d,c=u,u=d+g):3===l?(l=d,c=u-g):4===l?(l=d+g,c=d):(l=u,c=d,u-=g),e="#"+N(l)+N(c)+N(u)),n[o]=e}h.compiledHeatmaps=p}for(var m in C.container=s(document.createElement("div"),h.container),C.count=C.container.appendChild(s(document.createElement("div"),h.count)),C.legend=C.container.appendChild(s(document.createElement("div"),h.legend)),C.graph=F.graph?C.container.appendChild(s(document.createElement("div"),h.graph)):0,E.length=0,C)C[m]&&h[m].heatOn&&E.push({name:m,el:C[m]});if(M.length=0,C.graph)for(C.graph.style.width=F.history*h.column.width+(F.history-1)*h.column.spacing+"px",y=0;y<F.history;y++)M[y]=C.graph.appendChild(s(document.createElement("div"),h.column)),M[y].style.position="absolute",M[y].style.bottom=0,M[y].style.right=y*h.column.width+y*h.column.spacing+"px",M[y].style.width=h.column.width+"px",M[y].style.height="0px";s(C.container,F),r(),t.appendChild(C.container),C.graph&&(b=C.graph.clientHeight),F.toggleOn&&("click"===F.toggleOn&&(C.container.style.cursor="pointer"),S(C.container,F.toggleOn,G))}"object"===H(t)&&t.nodeType===e&&(o=t,t=document.body),t||(t=document.body);var h,p,l,f,x,b,w,y,v,O=this,F=I({},D.defaults,o||{}),C={},M=[],z=100,E=[],A=F.threshold,P=0,T=n()-A,j=[],q=[],L="fps"===F.show;O.options=F,O.fps=0,O.duration=0,O.isPaused=0,O.tickStart=function(){P=n()},O.tick=function(){l=n(),A+=(l-T-A)/F.smoothing,O.fps=1e3/A,O.duration=P<T?A:l-P,T=l},O.pause=function(){return f&&(O.isPaused=1,clearTimeout(f),a(f),a(x),f=x=0),O},O.resume=function(){return f||(O.isPaused=0,k()),O},O.set=function(t,e){return F[t]=e,L="fps"===F.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(C.container,F),O},O.showDuration=function(){return O.set("show","ms"),O},O.showFps=function(){return O.set("show","fps"),O},O.toggle=function(){return O.set("show",L?"ms":"fps"),O},O.hide=function(){return O.pause(),C.container.style.display="none",O},O.show=function(){return O.resume(),C.container.style.display="block",O},O.destroy=function(){O.pause(),U(),O.tick=O.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,p=0,l=(o=["moz","webkit","o"]).length;p<l&&!a;++p)i=(a=t[o[p]+"CancelAnimationFrame"]||t[o[p]+"CancelRequestAnimationFrame"])&&t[o[p]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout(function(){e(o+a)},a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick(),this.app.fire("update_fps",this.fps.fps)};var HotspotSprite=pc.createScript("hotspotSprite");HotspotSprite.attributes.add("cameraEntity",{type:"entity",title:"相机"}),HotspotSprite.attributes.add("fadeDropOff",{type:"number",default:.4,title:"淡出速度",description:"When to start fading out hotspot relative to the camera direction. 1 for when hotspot is directly inline with the camera. 0 for never."}),HotspotSprite.attributes.add("press_event",{type:"string",title:"click event"}),HotspotSprite.attributes.add("event_index",{type:"number",title:"event index"}),HotspotSprite.attributes.add("open_camera_event",{type:"string",title:"open position"}),HotspotSprite.attributes.add("close_camera_event",{type:"string",title:"close position"}),HotspotSprite.prototype.initialize=function(){this.defaultForwardDirection=this.entity.forward.clone(),this.directionToCamera=new pc.Vec3,this.sprite=this.entity.children[0],this.percent=1,this.doorPercent=0,this.isOpen=!1,this.PCScale=this.sprite.getLocalScale(),isPC()?this.sprite.setLocalScale(this.PCScale):this.sprite.setLocalScale(1.5*this.PCScale.x,1.5*this.PCScale.y,1.5*this.PCScale.z),this.sprite.element.on("click",this.onClick,this)},HotspotSprite.prototype.update=function(t){var e=this.cameraEntity.getPosition();this.entity.lookAt(e),this.directionToCamera.sub2(e,this.entity.getPosition()),this.directionToCamera.normalize();var i=this.directionToCamera.dot(this.defaultForwardDirection);if(i<0)this.sprite.enabled&&(this.sprite.enabled=!1);else{this.sprite.enabled||(this.sprite.enabled=!0);var s=pc.math.clamp(i/this.fadeDropOff,0,1);this.sprite.element.opacity=s}this.percent=Math.min(this.percent+.25*t,1),this.doorPercent=Math.min(4*this.percent,1)},HotspotSprite.prototype.fireEvent=function(){var t=this.event_index;15!==t||"5_liangqu_shushi"!==this.modelName&&"5_liangqu_zhixiang"!==this.modelName&&"5_siqu_haohua"!==this.modelName&&"7_liangqu_zhixiang"!==this.modelName||(t=17),""!==this.press_event?this.app.fire(this.press_event,t):window.site.trigger("hotDot:set",t)},HotspotSprite.prototype.onModelChange=function(t){this.modelName=t},HotspotSprite.prototype.onClick=function(t){this.sprite.enabled&&(this.entity.fire("pulse:start"),this.percent=0,this.fireEvent(),this.isOpen?(this.isOpen=!1,this.app.fire(this.close_camera_event)):(this.isOpen=!0,this.app.fire(this.open_camera_event)))};var ControlHotspot=pc.createScript("controlHotspot");ControlHotspot.attributes.add("allHotspots",{type:"entity",array:!0}),ControlHotspot.prototype.initialize=function(){this.app.on("Hotspot:isShow",this.onExtControlHotspotEventPreHandler,this)},ControlHotspot.prototype.update=function(t){},ControlHotspot.prototype.onExtControlHotspotEventPreHandler=function(t){if(t)for(var o=0;o<this.allHotspots.length;o++)this.allHotspots[o].enabled=!0;else for(var s=0;s<this.allHotspots.length;s++)this.allHotspots[s].enabled=!1};var AssetLoader=pc.createScript("assetLoader");AssetLoader.attributes.add("max_reload",{type:"number",title:"最大重载次数"}),AssetLoader.prototype.initialize=function(){this.reloadTimes=0},AssetLoader.prototype.startLoad=function(e,s){this.assetToLoad=e,this.loadAsset(e),this.succ_callback=s},AssetLoader.prototype.loadAsset=function(e){e.resource?this.onAssetLoaded(e):(e.once("load",this.onAssetLoaded,this),e.once("error",this.onAssetLoadErr,this),this.app.assets.load(e)),e||console.error("undefined asset")},AssetLoader.prototype.onAssetLoaded=function(e){this.succ_callback(e)},AssetLoader.prototype.onAssetLoadErr=function(e,s){if(this.reloadTimes++,this.reloadTimes===this.max_reload_times)return console.error("达到最大重试次数，读取资源失败: "+s.name),void this.app.fire("loadTextureFailed");this.loadAsset(s)};var MainUi=pc.createScript("mainUi");MainUi.attributes.add("colorGroupUI",{title:"ColorBtnGroup",type:"entity",array:!0}),MainUi.prototype.initialize=function(){this.app.on("switchScene:change_scene",this.onChangeSceneEventPreHandler,this)},MainUi.prototype.onChangeSceneEventPreHandler=function(e){for(var n=0;n<this.colorGroupUI.length;n++)this.colorGroupUI[n].enabled=n==e},MainUi.prototype.update=function(e){};var MaterialController=pc.createScript("materialController");MaterialController.attributes.add("materialsToReplaced",{type:"asset",assetType:"material",array:!0}),MaterialController.attributes.add("materialList",{type:"asset",assetType:"material",array:!0}),MaterialController.attributes.add("triggerEvent",{type:"string",title:"Trigger Event",description:"2 params: old mat index, new mat index"}),MaterialController.prototype.initialize=function(){this.app.on(this.triggerEvent,this.replaceMaterial,this),this.cloneList()},MaterialController.prototype.cloneList=function(){this.dict=[];var t=this,e=0;this.app.root.find(function(a){if(a.model){var i=a.model.meshInstances;if(!i)return;for(var r=0;r<i.length;++r)for(var l=i[r],s=0;s<t.materialsToReplaced.length;s++){var o=l.material.id;o===t.materialsToReplaced[s].resource.id&&t.dict.push({mesh:l,id:o,uid:e++})}}})},MaterialController.prototype.replaceMaterial=function(t,e){if(this.materialsToReplaced[t]&&this.materialList[e]){this.oldMat=this.materialsToReplaced[t].resource,this.newMat=this.materialList[e].resource,this.meshesToReplaced=[];for(var a=0;a<this.dict.length;a++){this.dict[a].id===this.materialsToReplaced[t].resource.id&&(this.dict[a].mesh.material=this.newMat,this.dict[a].id=this.newMat.id)}this.materialsToReplaced[t]=this.materialList[e]}},MaterialController.prototype.update=function(t){this.efxStart};var FaceCamera=pc.createScript("faceCamera");FaceCamera.attributes.add("face_target",{type:"entity",title:"朝向对象"}),FaceCamera.attributes.add("fade_threshold",{type:"number",title:"消失阈值"}),FaceCamera.attributes.add("rotate_to_forward",{type:"vec3",title:"旋转至理想正方向",description:"引擎默认正方向是相对坐标系的-Z轴，如果采用模式1或2，需要在使用引擎默认正方向计算后进行2次旋转，确保理想正方向朝向相机"}),FaceCamera.attributes.add("stick_to",{type:"entity",title:"粘粘Entity"}),FaceCamera.attributes.add("mode",{type:"number",title:"模式",default:0,enum:[{"1-自带element":0},{"2-自带model":1}]}),FaceCamera.prototype.initialize=function(){this.tmp_entity=new pc.Entity,this.tmp_entity.setPosition(this.entity.getPosition().clone()),this.tmp_entity.setRotation(this.entity.getRotation().clone()),this._rotation=this.entity.getRotation().clone(),this.tmp_entity.rotateLocal(this.rotate_to_forward),this.defualt_forward=this.tmp_entity.forward.clone(),this.directionToCamera=new pc.Vec3},FaceCamera.prototype.update=function(t){this.stick_to&&this.entity.setPosition(this.stick_to.getPosition());var e=this.face_target.getPosition();this.entity.lookAt(e,pc.Vec3.UP),this.entity.rotateLocal(-1*this.rotate_to_forward.x,-1*this.rotate_to_forward.y,-1*this.rotate_to_forward.z),this.directionToCamera.sub2(e,this.entity.getPosition()),this.directionToCamera.normalize();var i=this.directionToCamera.dot(this.defualt_forward),a=pc.math.clamp(i/this.fade_threshold,0,1);switch(this.mode){case 0:this.entity.element&&a>=0&&(this.entity.element.opacity=a);break;case 1:this.entity.model&&this.entity.model.meshInstances[0].material.opacity>=0&&(this.entity.model.meshInstances[0].material.opacity=a,this.entity.model.meshInstances[0].material.update())}};var EventController=pc.createScript("eventController");EventController.attributes.add("open_doors",{type:"string",title:"开门"}),EventController.attributes.add("close_doors",{type:"string",title:"关门"}),EventController.attributes.add("model_change",{type:"string",title:"更换车款"}),EventController.attributes.add("paint_change",{type:"string",title:"外观换色"}),EventController.attributes.add("scene_change",{type:"string",title:"内饰外观切换"}),EventController.attributes.add("hotspot_isShow",{type:"string",title:"热点显示隐藏"}),EventController.attributes.add("hotspot_click",{type:"string",title:"热点点击事件"}),EventController.attributes.add("default_model_name",{type:"string",title:"默认车型",default:"5_siqu_qijian",enum:[{"五座两驱舒适":"5_liangqu_shushi"},{"五座两驱质享":"5_liangqu_zhixiang"},{"五座两驱豪华":"5_liangqu_haohua"},{"五座四驱豪华":"5_siqu_haohua"},{"五座四驱旗舰":"5_siqu_qijian"},{"七座两驱质享":"7_liangqu_zhixiang"},{"TS豪华":"TS_haohua"}]}),EventController.attributes.add("default_paint",{type:"number",title:"默认颜色",default:0,enum:[{"深林棕":0},{"月光白":1},{"太空灰":2},{"玛瑙黑":3},{"战斗灰哑光漆":4}]}),EventController.prototype.initialize=function(){this.app.on(this.open_doors,this.openDoors,this),this.app.on(this.close_doors,this.closeDoors,this),this.app.on(this.model_change,this.changeModel,this),this.app.on(this.paint_change,this.changePaint,this),this.app.on(this.scene_change,this.changeScene,this),this.app.on(this.hotspot_isShow,this.changeHotspotsVisibility,this),this.app.on(this.hotspot_click,this.fe_showHotspot,this),this.setCurrentModel(this.default_model_name),this.changeModel(this.default_model_name),this.changePaint(this.default_paint),this.on("attr:default_model_name",this.changeModel,this),this.on("attr:default_paint",this.changePaint,this),this.currentScene=0,this.currentModelName=this.default_model_name},EventController.prototype.openDoors=function(){this.app.fire("ext:open_door_fl"),this.app.fire("ext:open_door_fr"),this.app.fire("ext:open_door_rl"),this.app.fire("ext:open_door_rr"),this.app.fire("ext:open_door_t")},EventController.prototype.closeDoors=function(){this.app.fire("ext:close_door_fl"),this.app.fire("ext:close_door_fr"),this.app.fire("ext:close_door_rl"),this.app.fire("ext:close_door_rr"),this.app.fire("ext:close_door_t")},EventController.prototype.changePaint=function(t){this.app.fire("material:change",0,t)},EventController.prototype.setCurrentModel=function(t){this.entity.script.modelController.setCurrentModel(t)},EventController.prototype.changeModel_extOnly=function(t){this.entity.script.modelController.changeModel(t)},EventController.prototype.changeModel=function(t){this.currentModelName=t,this.entity.script.modelController.changeModel(t),1==this.currentScene?this.entity.script.interiorController.changeModelInstantly(t):this.entity.script.interiorController.setDirtyModelName(t)},EventController.prototype.changeScene=function(t){this.entity.script.switchScene.onChangeSceneEventPreHandler(t),1==t&&this.entity.script.interiorController.changeModelDelayed(),0==t&&("TS_haohua"==this.currentModelName?this.changePaint(4):this.changePaint(0)),this.currentScene=t},EventController.prototype.changeHotspotsVisibility=function(t){this.entity.script.controlHotspot.onExtControllHotspotEventPreHandler(t)},EventController.prototype.fe_showHotspot=function(t){window.parent&&window.parent.floatx&&window.parent.floatx(t)},EventController.prototype.update=function(t){};var HeadlightController=pc.createScript("headlightController");HeadlightController.attributes.add("trigger_evt",{type:"string"}),HeadlightController.attributes.add("headlight_entity",{type:"entity",array:!0}),HeadlightController.attributes.add("daylight_entity",{type:"entity",array:!0}),HeadlightController.prototype.initialize=function(){this.bOn=!1,this.app.on(this.trigger_evt,this.onTrigger,this)},HeadlightController.prototype.update=function(t){},HeadlightController.prototype.onTrigger=function(){this.bOn=!this.bOn;for(var t=0;t<this.headlight_entity.length;t++)this.headlight_entity[t].enabled=this.bOn;for(t=0;t<this.daylight_entity.length;t++)this.bOn?this.daylight_entity[t].enabled=!1:this.daylight_entity[t].enabled=this.entity.script.modelController.isHighHeadlight()},HeadlightController.prototype.turnOffDayLight=function(){for(var t=0;t<this.daylight_entity.length;t++)this.daylight_entity[t].enabled=!1},HeadlightController.prototype.turnOnDayLight=function(){if(!this.bOn)for(var t=0;t<this.daylight_entity.length;t++)this.daylight_entity[t].enabled=!0};var ReflectionController=pc.createScript("reflectionController");ReflectionController.attributes.add("ref_materials",{type:"asset",assetType:"material",array:!0}),ReflectionController.attributes.add("low_cubemap",{type:"asset",assetType:"cubemap"}),ReflectionController.attributes.add("high_cubemap",{type:"asset",assetType:"cubemap"}),ReflectionController.attributes.add("low_cubemap_tags",{type:"string",array:!0}),ReflectionController.attributes.add("high_cubemap_tags",{type:"string",array:!0}),ReflectionController.prototype.initialize=function(){if(isPC())this.applyCubemaps(1);else{var e=mobilePlatform();-1!=this.high_cubemap_tags.indexOf(e)?this.applyCubemaps(1):this.applyCubemaps(0)}},ReflectionController.prototype.applyCubemaps=function(e){console.log("modify cubemaps "+e);for(var t=0;t<this.ref_materials.length;t++){var a=this.ref_materials[t].resource;a.cubeMap=0===e?this.low_cubemap.resource:this.high_cubemap.resource,a.update()}},ReflectionController.prototype.update=function(e){};